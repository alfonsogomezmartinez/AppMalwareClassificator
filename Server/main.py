from flask import Flask, request, jsonify, render_template
from utils import prediction_malware
import numpy as np
from FeaturesMalware import feature_malware
from werkzeug.utils import secure_filename
import os
from flask_ngrok import run_with_ngrok

app = Flask(__name__)
run_with_ngrok(app)
@app.route('/')
def index():
    return render_template('indexMalware.html')

@app.route('/malware', methods=["POST"])
def predmal():
    if request.method == "POST":
        f=request.files['file']
        filename = secure_filename(f.filename)
        if filename != '':
            f.save(filename)
            medidas_encoder = feature_malware(filename)
            feature = np.array(medidas_encoder)
            sol=prediction_malware(feature)
            sol=sol.tolist()
            os.remove(filename)
            if sol==[0]:
                res="Bening"
            elif sol==[1]:
                res="SMS"
            if sol==[2]:
                res="Riskware"
            elif sol==[3]:
                res="Adware"
            elif sol==[4]:
                res="Banking"
    return jsonify({'Category': res})

if __name__ == '__main__':
    app.run()